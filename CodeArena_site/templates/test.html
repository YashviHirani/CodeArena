<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CodeArena | Guest Preview</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <style>
        /* --- [KEEPING ALL YOUR EXISTING CSS STYLES] --- */
        /* ... (Your existing CSS variables, typography, cards, etc. remain exactly the same) ... */
        :root { --primary-glow: #20c997; --secondary-glow: #8f94fb; --bg-dark: #050505; --card-bg: rgba(255, 255, 255, 0.03); --card-border: rgba(255, 255, 255, 0.1); }
        body { margin: 0; padding: 0; background-color: var(--bg-dark); font-family: 'Inter', sans-serif; color: #e0e0e0; overflow-x: hidden; min-height: 100vh; }
        .bg-radial-fixed { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at top center, #1a1a2e 0%, #000000 70%); z-index: -1; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .text-cyan { color: #20c997; text-shadow: 0 0 10px rgba(32, 201, 151, 0.3); }
        .gradient-heading { font-family: 'Orbitron', sans-serif; background: linear-gradient(to right, #ffffff, #8a2be2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .plugin-card.futuristic { position: relative; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 20px; padding: 1.5rem; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); overflow: hidden; height: 100%; display: flex; flex-direction: column; justify-content: center; }
        .plugin-card.futuristic:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.06); border-color: rgba(32, 201, 151, 0.4); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); }
        .plugin-card.futuristic::after { content: ""; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--primary-glow), transparent); transform: translateX(-100%); transition: 0.6s; }
        .plugin-card.futuristic:hover::after { transform: translateX(100%); }
        .btn-glow { background: linear-gradient(90deg, #20c997, #4e54c8); color: white; border: none; padding: 0.4rem 1rem; font-weight: 600; border-radius: 8px; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(32, 201, 151, 0.2); text-decoration: none; cursor: pointer; }
        .btn-glow:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(32, 201, 151, 0.4); color: white; filter: brightness(1.1); }
        .form-control-dark, .form-select-dark { background: rgba(255, 255, 255, 0.05); border: 1px solid var(--card-border); color: #fff; border-radius: 10px; padding: 0.6rem 2.25rem 0.6rem 1rem; transition: all 0.3s ease; }
        .form-control-dark:focus, .form-select-dark:focus { background-color: rgba(255, 255, 255, 0.08); border-color: var(--primary-glow); box-shadow: 0 0 15px rgba(32, 201, 151, 0.1); color: #fff; outline: none; }
        .form-control-dark::placeholder { color: rgba(255, 255, 255, 0.4); }
        .form-select-dark { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 16px 12px; }
        .navbar-glass { background: rgba(10, 10, 20, 0.85) !important; backdrop-filter: blur(12px) saturate(180%); -webkit-backdrop-filter: blur(12px) saturate(180%); border-bottom: 1px solid rgba(255, 255, 255, 0.08); }
        .navbar-brand-custom { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; letter-spacing: 1px; background: linear-gradient(90deg, #20c997, #8f94fb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 15px rgba(32, 201, 151, 0.3); }
        .sidebar { width: 280px; background: rgba(10, 10, 20, 0.65); backdrop-filter: blur(15px); border-right: 1px solid rgba(255, 255, 255, 0.08); position: fixed; top: 0; bottom: 0; left: 0; display: flex; flex-direction: column; z-index: 1050; }
        .nav-link-custom { padding: 12px 20px; margin: 6px 15px; border-radius: 8px; color: rgba(255, 255, 255, 0.7); display: flex; align-items: center; gap: 12px; transition: all 0.3s ease; text-decoration: none; font-weight: 500; font-family: 'Inter', sans-serif; cursor: pointer; }
        .nav-link-custom:hover, .nav-link-custom.active { background: rgba(32, 201, 151, 0.1); color: #ffffff; box-shadow: 0 0 15px rgba(32, 201, 151, 0.1); border-left: 2px solid var(--primary-glow); }
        .nav-link-custom i { transition: transform 0.3s; }
        .nav-link-custom:hover i { transform: scale(1.1); color: var(--primary-glow); }
        .custom-scroll-container { max-height: 60vh; overflow-y: auto; overflow-x: auto; }
        .custom-scroll-container::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll-container::-webkit-scrollbar-thumb { background: #2b2b40; border-radius: 3px; }
        .custom-scroll-container::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        .table { color: #cfcfe6; --bs-table-bg: transparent; }
        .table thead th { background: rgba(10, 10, 20, 0.9); backdrop-filter: blur(5px); color: var(--primary-glow); font-family: 'Orbitron', sans-serif; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 18px; position: sticky; top: 0; z-index: 10; }
        .table tbody td { padding: 18px; border-color: rgba(255, 255, 255, 0.05); vertical-align: middle; font-size: 0.95rem; }
        .table-hover tbody tr:hover { background-color: rgba(255, 255, 255, 0.03) !important; box-shadow: inset 2px 0 0 var(--secondary-glow); }
        .avatar-circle { width: 45px; height: 45px; background: linear-gradient(135deg, #6c757d, #adb5bd); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #fff; font-family: 'Orbitron', sans-serif; box-shadow: 0 0 10px rgba(108, 117, 125, 0.5); }
        .main-content { padding: 20px; transition: margin-left 0.3s ease; flex-grow: 1; }
        @media (min-width: 992px) { .main-content { margin-left: 280px; padding: 40px; } }
        .progress { background-color: rgba(255,255,255,0.1); border-radius: 20px; overflow: hidden; }
        .progress-bar { border-radius: 20px; }
        .bg-gradient-primary { background: linear-gradient(90deg, #20c997, #4e54c8); box-shadow: 0 0 10px rgba(32, 201, 151, 0.4); }
        .bg-gradient-success { background: linear-gradient(90deg, #00b09b, #96c93d); }
        .bg-gradient-warning { background: linear-gradient(90deg, #f6d365, #fda085); }
        
        /* Modal Styles */
        .modal-content-glass { background: rgba(15, 15, 25, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); color: white; border-radius: 20px; box-shadow: 0 0 50px rgba(32, 201, 151, 0.2); }
        .modal-header { border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .modal-footer { border-top: 1px solid rgba(255, 255, 255, 0.1); }

        /* --- ADDED: EDITOR STYLES --- */
        .editor-area {
            background-color: #0d0d15;
            color: #d4d4d4;
            font-family: 'Courier New', Courier, monospace;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            width: 100%;
            height: 60vh;
            padding: 15px;
            resize: none;
        }
        .editor-area:focus {
            outline: none;
            border-color: var(--primary-glow);
        }
    </style>
</head>
{% csrf_token %}
<body>
    
    <div class="bg-radial-fixed"></div>

    <nav class="navbar navbar-expand-lg navbar-glass d-lg-none sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand-custom" href="#">CodeArena</a>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#mobileMenu">
                <span class="navbar-toggler-icon" style="filter: invert(1);"></span>
            </button>
            <div class="collapse navbar-collapse" id="mobileMenu">
                <ul class="navbar-nav mt-3">
                    <li class="nav-item"><a class="nav-link-custom auth-trigger" href="#"><i class="bi bi-person"></i> Profile</a></li>
                    <li class="nav-item"><a class="nav-link-custom auth-trigger" href="#"><i class="bi bi-cpu"></i> Quiz</a></li>
                    <li class="nav-item"><a class="nav-link-custom auth-trigger" href="#"><i class="bi bi-trophy"></i> Leaderboard</a></li>
                    <li class="nav-item"><a class="nav-link-custom auth-trigger" href="#"><i class="bi bi-gear"></i> Settings</a></li>
                    <hr class="border-secondary opacity-25">
                    <li class="nav-item d-flex align-items-center gap-3 py-2 px-3">
                        <div class="avatar-circle" style="width:35px; height:35px; font-size: 0.8rem;">?</div>
                        <div>
                            <div class="fw-bold text-white small">Guest User</div>
                            <div class="text-secondary" style="font-size: 0.7rem;">Please Login</div>
                        </div>
                    </li>
                    <li class="nav-item mt-2 px-3">
                        <a href="{%url 'login' %}" class="btn btn-glow w-100 btn-sm auth-trigger">Login / Register</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <aside class="sidebar d-none d-lg-flex">
        <div class="p-4 border-bottom border-white border-opacity-10">
            <span class="navbar-brand-custom">CodeArena</span>
        </div>

        <nav class="mt-4 flex-grow-1">
            <a href="#" class="nav-link-custom auth-trigger"><i class="bi bi-person"></i> Profile</a>
            <a href="#" class="nav-link-custom auth-trigger"><i class="bi bi-cpu"></i> Quiz</a>
            <a href="#" class="nav-link-custom auth-trigger"><i class="bi bi-trophy"></i> Leaderboard</a>
        </nav>

        <div class="p-4 mt-auto border-top border-white border-opacity-10">
            <div class="d-flex align-items-center gap-3 mb-3">
                <div class="avatar-circle">?</div>
                <div>
                    <div class="fw-bold text-white">Guest User</div>
                    <div class="text-secondary small">Rank: N/A</div>
                </div>
            </div>
            <a href="#" class="btn btn-glow w-100 rounded-pill auth-trigger">Login / Register</a>
        </div>
    </aside>

    <main class="main-content">
        <div class="d-flex justify-content-between align-items-end mb-5">
            <div>
                <h2 class="fw-bold gradient-heading text-start mb-2">Explore Arena</h2>
                <p class="text-secondary mb-0">Join our community to track progress and solve challenges.</p>
            </div>
        </div>

        <div class="row g-4 mb-5">
            <div class="col-md-4">
                <div class="plugin-card futuristic">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-uppercase text-secondary small letter-spacing-1">Platform Problems</h6>
                            <h2 class="fw-bold mt-2 display-6 font-orbitron">500+</h2>
                        </div>
                        <i class="bi bi-journal-code text-cyan fs-2"></i>
                    </div>
                    <div class="progress mt-3" style="height: 6px;">
                        <div class="progress-bar bg-gradient-primary" style="width: 100%"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="plugin-card futuristic">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-uppercase text-secondary small letter-spacing-1">Your Solved</h6>
                            <h2 class="fw-bold mt-2 display-6 font-orbitron">0</h2>
                        </div>
                        <i class="bi bi-lock text-secondary fs-2 opacity-50"></i>
                    </div>
                    <div class="progress mt-3" style="height: 6px;">
                        <div class="progress-bar bg-secondary" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="plugin-card futuristic p-0 overflow-hidden d-block">
            <div class="p-4 border-bottom border-white border-opacity-10">
                <div class="row align-items-center g-3">
                    <div class="col-lg-4">
                        <h5 class="mb-0 fw-bold font-orbitron"><i class="bi bi-list-task me-2 text-cyan"></i>Sample Problems</h5>
                    </div>
                    <div class="col-lg-8">
                        <div class="row g-2">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text bg-transparent border-end-0 text-secondary" style="border-color: rgba(255,255,255,0.1); border-top-left-radius: 10px; border-bottom-left-radius: 10px;">
                                        <i class="bi bi-search"></i>
                                    </span>
                                    <input class="form-control form-control-dark border-start-0 ps-0" placeholder="Search problems...">
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <select class="form-select form-select-dark">
                                    <option>Difficulty: All</option>
                                    <option>Easy</option>
                                    <option>Medium</option>
                                    <option>Hard</option>
                                </select>
                            </div>
                            <div class="col-6 col-md-3">
                                <select class="form-select form-select-dark">
                                    <option>Topic: All</option>
                                    <option>Arrays</option>
                                    <option>Strings</option>
                                    <option>Math</option>
                                    <option>Binary Search</option>
                                    <option>Dynamic Programming</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="custom-scroll-container">
                <table class="table table-hover mb-0 align-middle">
                    <thead>
                        <tr>
                            <th class="ps-4">Status</th>
                            <th>Problem Name</th>
                            <th>Difficulty</th>
                            <th>Category</th>
                            <th class="text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="ps-4"><i class="bi bi-circle text-secondary opacity-50"></i></td>
                            <td>
                                <div class="fw-bold text-white problem-title">Two Sum</div>
                                <small class="text-secondary">Find two numbers that add up to target...</small>
                            </td>
                            <td><span class="fw-bold text-success">Easy</span></td>
                            <td><span class="badge bg-white bg-opacity-10 text-white fw-normal border border-white border-opacity-10">Arrays</span></td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-glow solve-trigger">Solve</button>
                            </td>
                        </tr>

                        <tr>
                            <td class="ps-4"><i class="bi bi-circle text-secondary opacity-50"></i></td>
                            <td>
                                <div class="fw-bold text-white problem-title">Longest Substring</div>
                                <small class="text-secondary">Find substring without repeating chars...</small>
                            </td>
                            <td><span class="fw-bold text-warning">Medium</span></td>
                            <td><span class="badge bg-white bg-opacity-10 text-white fw-normal border border-white border-opacity-10">Strings</span></td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-glow solve-trigger">Solve</button>
                            </td>
                        </tr>

                        <tr>
                            <td class="ps-4"><i class="bi bi-circle text-secondary opacity-50"></i></td>
                            <td>
                                <div class="fw-bold text-white problem-title">Merge K Lists</div>
                                <small class="text-secondary">Merge k sorted linked lists into one...</small>
                            </td>
                            <td><span class="fw-bold text-danger">Hard</span></td>
                            <td><span class="badge bg-white bg-opacity-10 text-white fw-normal border border-white border-opacity-10">Linked List</span></td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-glow solve-trigger">Solve</button>
                            </td>
                        </tr>

                        <tr>
                            <td class="ps-4"><i class="bi bi-circle text-secondary opacity-50"></i></td>
                            <td>
                                <div class="fw-bold text-white problem-title">Valid Palindrome</div>
                                <small class="text-secondary">Check if string is a valid palindrome...</small>
                            </td>
                            <td><span class="fw-bold text-success">Easy</span></td>
                            <td><span class="badge bg-white bg-opacity-10 text-white fw-normal border border-white border-opacity-10">Two Pointers</span></td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-glow solve-trigger">Solve</button>
                            </td>
                        </tr>
                        
                        <tr style="position: relative;">
                            <td colspan="5" class="text-center py-5">
                                <div style="filter: blur(4px); opacity: 0.5; user-select: none;">
                                    <div class="d-flex justify-content-between px-4">
                                        <span>Hidden Problem #123</span>
                                        <span>Hard</span>
                                        <span>DP</span>
                                    </div>
                                    <br>
                                    <div class="d-flex justify-content-between px-4">
                                        <span>Hidden Problem #124</span>
                                        <span>Medium</span>
                                        <span>Graph</span>
                                    </div>
                                </div>
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2;">
                                    <button class="btn btn-glow auth-trigger">Login to View More</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <div class="modal fade" id="editorModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content modal-content-glass rounded-0" style="background: #050505;">
                <div class="modal-header border-bottom border-secondary border-opacity-25">
                    <div>
                        <h5 class="modal-title font-orbitron text-cyan" id="editorProblemTitle">Two Sum</h5>
                        <small class="text-secondary">Python 3</small>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container h-100 d-flex flex-column">
                        <div class="row flex-grow-1">
                            <div class="col-lg-4 border-end border-secondary border-opacity-25 p-3 d-none d-lg-block">
                                <h6 class="text-white fw-bold">Description</h6>
                                <p class="text-secondary small mt-3">
                                    Given an array of integers nums and an integer target, return indices of the two numbers such that they add up to target.
                                    <br><br>
                                    You may assume that each input would have exactly one solution, and you may not use the same element twice.
                                </p>
                                <div class="mt-4">
                                    <span class="badge bg-secondary bg-opacity-25 text-white">Example 1</span>
                                    <div class="bg-dark p-2 rounded mt-2 border border-secondary border-opacity-25 text-secondary small">
                                        Input: nums = [2,7,11,15], target = 9<br>
                                        Output: [0,1]
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-8 p-3 d-flex flex-column">
                                <h6 class="text-white fw-bold mb-3"><i class="bi bi-code-square me-2"></i>Solution</h6>
                                <textarea class="editor-area p-3" spellcheck="false">
class Solution:
    def solve(self, nums: List[int], target: int) -> List[int]:
        # Write your code here
        pass
                                </textarea>
                                <div class="mt-auto d-flex justify-content-end gap-2 pt-3">
                                    <button class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                                    <button class="btn btn-glow btn-sm px-4" id="submitCodeBtn">
                                        <i class="bi bi-play-fill me-1"></i> Submit Solution
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-content-glass">
                <div class="modal-header">
                    <h5 class="modal-title font-orbitron text-cyan">Submit Solution</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <div class="mb-3">
                        <i class="bi bi-shield-lock text-secondary" style="font-size: 3rem;"></i>
                    </div>
                    <h4 class="fw-bold mb-3">Save Your Progress</h4>
                    <p class="text-secondary mb-4">To submit this solution, update your rank, and save your progress, you need to log in.</p>
                    <div class="d-grid gap-2">
                        <a href="{% url 'login' %}" class="btn btn-glow">Log In & Submit</a>
                        <a href="{% url 'signup' %}" class="btn btn-outline-light">Create Account</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // 1. GET USER AUTH STATUS FROM DJANGO
        // Django renders "True" or "False", we convert to JS boolean
        const isAuthenticated = "{{ user.is_authenticated }}" === "True";

        function runSim() {
            const res = document.getElementById('testResult');
            res.innerHTML = '<span class="text-info"><span class="spinner-border spinner-border-sm me-2"></span>Running...</span>';
            setTimeout(() => {
                res.innerHTML = '<span class="text-success fw-bold"><i class="bi bi-check-circle-fill me-2"></i>Sample Test Case Passed!</span>';
            }, 800);
        }

        function submitSim() {
            {% if problem %}
        // If a problem exists, generate the URL normally
        const submitUrl = "{% url 'submit_solution' problem.id %}";
    {% else %}
        // If no problem is loaded, provide a fallback or null to prevent crash
        console.error("No problem loaded in context!");
        const submitUrl = ""; 
    {% endif %}

    if (submitUrl) {
        fetch(submitUrl, {
            // ... rest of your fetch code
        });
    }
            // 2. CHECK IF LOGGED IN
            if (!isAuthenticated) {
                // If not logged in, show the modal and STOP execution
                const loginModal = new bootstrap.Modal(document.getElementById('loginPromptModal'));
                loginModal.show();
                return; 
            }

            // 3. IF LOGGED IN, PROCEED AS NORMAL
            const code = document.getElementById("codeEditor").value;
            const language = document.getElementById("languageSelect").value;
            console.log("Submitting:", language, code);

            fetch("{% url 'submit_solution' problem.id %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify({
                    code: code,
                    language: language
                })
            })
            .then(res => res.json())
            .then(data => {
                console.log("Server response:", data);

                // Clear previous highlights
                document.querySelectorAll(".testcase-row").forEach(tc => {
                    tc.classList.remove("testcase-failed");
                });

                let outputHTML = `<div>‚öñÔ∏è Verdict: <b>${data.verdict}</b></div>`;

                if (data.verdict === "Accepted") {
                    outputHTML += `
                        <div>‚è± Time: ${data.time_ms} ms</div>
                        <div>üíæ Memory: ${data.memory_mb} MB</div>
                    `;
                } else {
                    outputHTML += `<div class="text-danger mt-2">‚ùå Failed</div>`;

                    if (data.failed_testcase) {
                        const failedTC = document.querySelector(
                            `.testcase-row[data-testcase="${data.failed_testcase}"]`
                        );
                        if (failedTC) {
                            failedTC.classList.add("testcase-failed");
                            failedTC.scrollIntoView({ behavior: "smooth", block: "center" });
                        }
                    }

                    if (data.error) {
                        outputHTML += `
                            <pre class="text-danger small mt-2">${data.error}</pre>
                        `;
                    }
                }

                document.getElementById("submissionResult").innerHTML = outputHTML;
            })
            .catch(err => {
                alert("Submission failed");
                console.error(err);
            });     
        }
        document.addEventListener('DOMContentLoaded', function() {
            // Modals
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            const editorModal = new bootstrap.Modal(document.getElementById('editorModal'));

            // 1. Sidebar & Nav Links (Direct Lock)
            const lockedElements = document.querySelectorAll('.auth-trigger');
            lockedElements.forEach(el => {
                el.addEventListener('click', function(e) {
                    e.preventDefault(); 
                    loginModal.show();
                });
            });

            // 2. "Solve" Buttons (Open Editor)
            const solveButtons = document.querySelectorAll('.solve-trigger');
            solveButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Get title from the same row
                    const title = this.closest('tr').querySelector('.problem-title').innerText;
                    document.getElementById('editorProblemTitle').innerText = title;
                    editorModal.show();
                });
            });

            // 3. "Submit" Button inside Editor (Triggers Login)
            const submitBtn = document.getElementById('submitCodeBtn');
            submitBtn.addEventListener('click', function() {
                editorModal.hide(); // Close editor
                // Small delay to make transition smooth
                setTimeout(() => {
                    loginModal.show(); // Open login
                }, 400);
            });
        });
    </script>

    <div class="modal fade" id="loginPromptModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: rgba(15, 15, 26, 0.95); border: 1px solid var(--primary-glow); backdrop-filter: blur(10px);">
                <div class="modal-header border-bottom border-white border-opacity-10">
                    <h5 class="modal-title font-heading text-cyan">
                        <i class="bi bi-lock-fill me-2"></i>Access Denied
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <p class="fs-5 text-light opacity-75 mb-4">
                        You must be logged in to submit a solution to the Arena.
                    </p>
                    <div class="d-flex justify-content-center gap-3">
                        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                        <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-glow text-white text-decoration-none">
                            Login Now <i class="bi bi-box-arrow-in-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>